<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
        <!-- í˜ì´ì§€ ìŠ¤íƒ€ì¼ -->
        <link rel="stylesheet" href="/css/fund/fund_detail.css" />
        <!-- í”„ë ˆê·¸ë¨¼íŠ¸ ìŠ¤íƒ€ì¼ -->
        <link rel="stylesheet" href="/css/userHeader.css" />
        <link rel="stylesheet" href="/css/footer.css" />
        <link rel="stylesheet" href="/css/fundMainHeader.css" />
        <!-- ì œëª© -->
        <title>í€ë“œ ìƒì„¸ ì •ë³´</title>
    </head>
    <body>
        <!-- í—¤ë” ì˜ì—­ -->
        <th:block th:replace="fragments/userHeader :: userHeader"></th:block>
        <th:block
            th:replace="fragments/fundMainHeader :: fundMainHeader"
        ></th:block>
        <!-- ë©”ì¸ ì˜ì—­ -->
        <div class="container">
            <!-- í˜ì´ì§€ ì œëª© ì˜ì—­ -->
            <div class="page-title-container">
                <h1 class="page-title">í€ë“œ ìƒì„¸</h1>
            </div>

            <!-- ì—ëŸ¬ í‘œì‹œ -->
            <div id="error" class="error hidden">
                <p id="error-message">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            </div>

            <!-- â”€â”€ ë¡œë”© ì˜¤ë²„ë ˆì´ â”€â”€ -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>í€ë“œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <!-- í€ë“œ ìƒì„¸ ì»¨í…Œì´ë„ˆ -->
            <div id="fund-detail-container" class="fund-detail-container">
                <!-- í€ë“œëª… -->
                <div class="fund-item-container">
                    <h2 class="item-title">í€ë“œëª…</h2>
                    <span id="fund-name" class="fund-name">
                        <!-- ë™ì ìœ¼ë¡œ ë¡œë“œ -->
                    </span>
                </div>

                <!-- í€ë“œ ìƒì„¸ ì •ë³´ -->
                <div class="fund-item-container">
                    <h2 class="item-title">í€ë“œ ìƒì„¸ ì •ë³´</h2>
                    <table class="fund-info-table">
                        <tr>
                            <th>í€ë“œ ìœ í˜•</th>
                            <td id="fund-type">-</td>
                            <th>ìš´ìš©íšŒì‚¬</th>
                            <td id="management-company">-</td>
                        </tr>
                        <tr>
                            <th>íˆ¬ì ì§€ì—­</th>
                            <td id="investment-region">-</td>
                            <th>ìœ„í—˜ ë“±ê¸‰</th>
                            <td>
                                <span id="risk-level" class="risk-level">
                                    -
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <th>ì„¤ì •ì¼</th>
                            <td id="establish-date">-</td>
                            <th>ì¶œë²”ì¼</th>
                            <td id="launch-date">-</td>
                        </tr>
                        <tr>
                            <th>ê¸°ì¤€ê°€</th>
                            <td id="nav">-</td>
                            <th>ìˆœìì‚°</th>
                            <td id="aum">-</td>
                        </tr>
                        <tr>
                            <th>ì´ ë³´ìˆ˜ìœ¨</th>
                            <td id="total-expense-ratio">-</td>
                            <td colspan="2"></td>
                        </tr>
                    </table>
                </div>

                <!-- í€ë“œ ìˆ˜ìµë¥  -->
                <div class="fund-item-container">
                    <h2 class="item-title">í€ë“œ ìˆ˜ìµë¥  ì •ë³´</h2>
                    <!-- ìˆ˜ìµë¥  ë§‰ëŒ€ ê·¸ë˜í”„ -->
                    <canvas id="fundChart"></canvas>
                    <!-- ìˆ˜ìµë¥  ìƒì„¸ í…Œì´ë¸” -->
                    <table class="return-table" id="returnTable">
                        <thead>
                            <tr>
                                <th>êµ¬ë¶„</th>
                                <th>1ê°œì›”</th>
                                <th>3ê°œì›”</th>
                                <th>6ê°œì›”</th>
                                <th>12ê°œì›”</th>
                            </tr>
                        </thead>
                        <tbody id="returnTableBody">
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>

                <!-- í€ë“œ í¬íŠ¸í´ë¦¬ì˜¤ -->
                <div class="fund-item-container">
                    <h2 class="item-title">í€ë“œ í¬íŠ¸í´ë¦¬ì˜¤</h2>
                    <!-- í¬íŠ¸í´ë¦¬ì˜¤ ì½˜í…ì¸  -->
                    <div class="portfolio-content">
                        <!-- ì¢Œì¸¡ í…Œì´ë¸” -->
                        <div class="portfolio-table-section">
                            <table class="portfolio-table" id="portfolioTable">
                                <thead>
                                    <tr>
                                        <th>êµ¬ë¶„</th>
                                        <th>ìì‚° ë¹„ì¤‘</th>
                                    </tr>
                                </thead>
                                <tbody id="portfolioTableBody">
                                    <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                                </tbody>
                            </table>
                        </div>

                        <!-- ìš°ì¸¡ ë„ë„› ì°¨íŠ¸ -->
                        <div class="portfolio-chart-section">
                            <canvas id="portfolioChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- í€ë“œ ê³µì‹œìë£Œ -->
                <!-- 
                    <div class="fund-item-container">
                        <h2 class="item-title">í€ë“œ ê³µì‹œìë£Œ</h2>
                    </div>
                -->
            </div>

            <!-- ë²„íŠ¼ ì˜ì—­ -->
            <div class="button-container">
                <button class="page-btn btn-secondary" onclick="goBack()">
                    ë’¤ë¡œê°€ê¸°
                </button>
                <button class="page-btn btn-primary" onclick="joinFund()">
                    ê°€ì…í•˜ê¸°
                </button>
            </div>
        </div>

        <!-- í‘¸í„° ì˜ì—­ -->
        <th:block th:replace="fragments/footer :: siteFooter"></th:block>
    </body>

    <script>
        let chart;
        let portfolioChart;
        let fundData = null;
        let currentUserId = null;
        let currentInvestType = null;

        // URLì—ì„œ fundId ì¶”ì¶œ
        /* function getFundIdFromUrl() {
            const pathParts = window.location.pathname.split("/");
            const fundIdIndex = pathParts.indexOf("fund") + 1;
            return pathParts[fundIdIndex]
                ? parseInt(pathParts[fundIdIndex])
                : null;
        } */

        // ë©”íƒ€ íƒœê·¸ì—ì„œ ë°ì´í„° ì¶”ì¶œ
        function getDataFromMeta() {
            const fundIdElement = document.querySelector(
                'meta[name="fund-id"]'
            );
            const investTypeElement = document.querySelector(
                'meta[name="invest-type"]'
            );
            const userIdElement = document.querySelector(
                'meta[name="user-id"]'
            );

            const fundId = fundIdElement
                ? parseInt(fundIdElement.getAttribute("content"))
                : null;
            const investType = investTypeElement
                ? parseInt(investTypeElement.getAttribute("content"))
                : null;
            const userId = userIdElement
                ? parseInt(userIdElement.getAttribute("content"))
                : null;

            console.log("ë©”íƒ€ íƒœê·¸ì—ì„œ ì¶”ì¶œëœ ë°ì´í„°:", {
                fundId,
                investType,
                userId,
            });

            return { fundId, investType, userId };
        }

        // ë¡œë”© ìƒíƒœ ê´€ë¦¬
        function showLoading() {
            document.getElementById("loading").classList.remove("hidden");
            document
                .getElementById("fund-detail-container")
                .classList.add("hidden");
            document.getElementById("error").classList.add("hidden");
        }

        function hideLoading() {
            document.getElementById("loading").classList.add("hidden");
        }

        function showError(message) {
            document.getElementById("error-message").textContent = message;
            document.getElementById("error").classList.remove("hidden");
            document
                .getElementById("fund-detail-container")
                .classList.add("hidden");
        }

        function showContent() {
            document
                .getElementById("fund-detail-container")
                .classList.remove("hidden");
        }

        // í€ë“œ ìƒì„¸ ì •ë³´ API í˜¸ì¶œ
        async function loadFundDetail(fundId) {
            try {
                showLoading();

                const response = await fetch(`/api/funds/detail/${fundId}`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    credentials: "include",
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const apiResponse = await response.json();

                if (!apiResponse.success) {
                    throw new Error(apiResponse.message || "ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨");
                }

                fundData = apiResponse.data;
                renderFundDetail(fundData);
            } catch (error) {
                console.error("í€ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
                showError(
                    "í€ë“œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
                );
            } finally {
                hideLoading();
            }
        }

        // í€ë“œ ìƒì„¸ ì •ë³´ ë Œë”ë§
        function renderFundDetail(data) {
            try {
                // í€ë“œëª…
                document.getElementById("fund-name").textContent =
                    data.fundName || "-";

                // í€ë“œ ìƒì„¸ ì •ë³´
                document.getElementById("fund-type").textContent =
                    data.fundType || "-";
                document.getElementById("management-company").textContent =
                    data.managementCompany || "-";
                document.getElementById("investment-region").textContent =
                    data.investmentRegion || "-";

                // ìœ„í—˜ ë“±ê¸‰
                const riskElement = document.getElementById("risk-level");
                riskElement.textContent = getRiskText(data.riskLevel);
                riskElement.className = `risk-level risk-${data.riskLevel}`;

                // ë‚ ì§œ í¬ë§·íŒ…
                document.getElementById("establish-date").textContent =
                    formatDate(data.establishDate);
                document.getElementById("launch-date").textContent = formatDate(
                    data.launchDate
                );

                // ìˆ«ì í¬ë§·íŒ…
                document.getElementById("nav").textContent =
                    formatNumber(data.nav) + "ì›";
                document.getElementById("aum").textContent =
                    (data.aum || 0) + "ì–µì›";
                document.getElementById("total-expense-ratio").textContent =
                    (data.totalExpenseRatio || 0).toFixed(2) + "%";

                // ìˆ˜ìµë¥  ë Œë”ë§
                renderChart(data);
                renderReturnTable(data);

                // í¬íŠ¸í´ë¦¬ì˜¤ ë Œë”ë§
                renderPortfolio(data);

                showContent();
            } catch (error) {
                console.error("ë°ì´í„° ë Œë”ë§ ì‹¤íŒ¨:", error);
                showError("ë°ì´í„°ë¥¼ í‘œì‹œí•˜ëŠ”ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateStr) {
            if (!dateStr) return "-";
            return dateStr.replace(/-/g, ". ").replace(/\.$/, "");
        }
        // ìˆ«ì í¬ë§·íŒ…
        function formatNumber(value) {
            if (value === null || value === undefined) return "0";
            return value.toLocaleString();
        }
        // ìœ„í—˜ë“±ê¸‰ í…ìŠ¤íŠ¸
        function getRiskText(riskLevel) {
            const riskTexts = {
                1: "1ë“±ê¸‰ (ë§¤ìš°ë†’ì€ìœ„í—˜)",
                2: "2ë“±ê¸‰ (ë†’ì€ìœ„í—˜)",
                3: "3ë“±ê¸‰ (ë‹¤ì†Œë†’ì€ìœ„í—˜)",
                4: "4ë“±ê¸‰ (ë³´í†µìœ„í—˜)",
                5: "5ë“±ê¸‰ (ë‚®ì€ìœ„í—˜)",
                6: "6ë“±ê¸‰ (ë§¤ìš°ë‚®ì€ìœ„í—˜)",
            };
            return riskTexts[riskLevel] || `${riskLevel}ë“±ê¸‰`;
        }

        // ìˆ˜ìµë¥  ë Œë”ë§
        function renderChart(data) {
            const ctx = document.getElementById("fundChart").getContext("2d");

            const returns = [
                parseFloat(data.return1m || 0),
                parseFloat(data.return3m || 0),
                parseFloat(data.return6m || 0),
                parseFloat(data.return12m || 0),
            ];

            // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: ["1ê°œì›”", "3ê°œì›”", "6ê°œì›”", "12ê°œì›”"],
                    datasets: [
                        {
                            label: "ìˆ˜ìµë¥  (%)",
                            data: returns,
                            backgroundColor: returns.map(getColor),
                            borderColor: returns.map(getBorderColor),
                            barPercentage: 0.4,
                            borderSkipped: "bottom",
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: "ê¸°ê°„ë³„ ìˆ˜ìµë¥  (%)",
                            font: { size: 16, weight: "bold" },
                            padding: { top: 10, bottom: 20 },
                        },
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const value = context.parsed.y;
                                    return `ìˆ˜ìµë¥ : ${
                                        value >= 0 ? "+" : ""
                                    }${value.toFixed(2)}%`;
                                },
                                afterLabel: function (context) {
                                    const value = context.parsed.y;
                                    if (value > 0) return "ğŸ”´ ìˆ˜ìµ";
                                    if (value < 0) return "ğŸ”µ ì†ì‹¤";
                                    return "â– ë³€ë™ ì—†ìŒ";
                                },
                            },
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: "ìˆ˜ìµë¥  (%)",
                                font: { size: 14, weight: "bold" },
                            },
                            grid: {
                                color: "rgba(0,0,0,0.1)",
                                drawBorder: false,
                            },
                            ticks: {
                                callback: function (value) {
                                    return value + "%";
                                },
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: "íˆ¬ì ê¸°ê°„",
                                font: { size: 14, weight: "bold" },
                            },
                            grid: { display: false },
                        },
                    },
                    animation: { duration: 1500, easing: "easeInOutQuart" },
                    interaction: { intersect: false, mode: "index" },
                },
            });
        }
        function renderReturnTable(data) {
            const tbody = document.getElementById("returnTableBody");
            tbody.innerHTML = "";

            const returns = [
                parseFloat(data.return1m || 0),
                parseFloat(data.return3m || 0),
                parseFloat(data.return6m || 0),
                parseFloat(data.return12m || 0),
            ];

            const row = document.createElement("tr");
            row.innerHTML = `
                    <td style="text-align: left; font-weight: 500;">ìˆ˜ìµë¥ </td>
                    <td class="${getReturnClass(
                        returns[0]
                    )}">${formatReturnPercentage(returns[0])}%</td>
                    <td class="${getReturnClass(
                        returns[1]
                    )}">${formatReturnPercentage(returns[1])}%</td>
                    <td class="${getReturnClass(
                        returns[2]
                    )}">${formatReturnPercentage(returns[2])}%</td>
                    <td class="${getReturnClass(
                        returns[3]
                    )}">${formatReturnPercentage(returns[3])}%</td>
                `;
            tbody.appendChild(row);
        }

        // í¬íŠ¸í´ë¦¬ì˜¤ ë Œë”ë§
        function renderPortfolio(data) {
            // í…Œì´ë¸” ë Œë”ë§
            renderPortfolioTable(data);

            // ë„ë„› ì°¨íŠ¸ ë Œë”ë§
            renderPortfolioChart(data);
        }
        // í¬íŠ¸í´ë¦¬ì˜¤ í…Œì´ë¸” ë Œë”ë§
        function renderPortfolioTable(data) {
            const tbody = document.getElementById("portfolioTableBody");
            tbody.innerHTML = "";

            // í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„° ë°°ì—´
            const portfolioItems = [
                {
                    name: "êµ­ë‚´ì£¼ì‹",
                    value: parseFloat(data.domesticStock || 0),
                },
                {
                    name: "í•´ì™¸ì£¼ì‹",
                    value: parseFloat(data.overseasStock || 0),
                },
                { name: "êµ­ë‚´ì±„ê¶Œ", value: parseFloat(data.domesticBond || 0) },
                { name: "í•´ì™¸ì±„ê¶Œ", value: parseFloat(data.overseasBond || 0) },
                {
                    name: "í€ë“œíˆ¬ì",
                    value: parseFloat(data.fundInvestment || 0),
                },
                { name: "ìœ ë™ì„±", value: parseFloat(data.liquidity || 0) },
            ];

            // ëª¨ë“  í•­ëª©ì„ í‘œì‹œ (0% í¬í•¨)
            portfolioItems.forEach((item) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                        <td style="text-align: left; font-weight: 500;">
                            <span class="portfolio-legend" data-asset="${
                                item.name
                            }"></span>
                            ${item.name}
                        </td>
                        <td class="${getPercentageClass(
                            item.value
                        )}">${formatPercentage(item.value)}%</td>
                    `;
                tbody.appendChild(row);
            });
        }
        // í¬íŠ¸í´ë¦¬ì˜¤ ë„ë„› ì°¨íŠ¸ ë Œë”ë§
        function renderPortfolioChart(data) {
            const ctx = document
                .getElementById("portfolioChart")
                .getContext("2d");

            // í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„° ì¤€ë¹„
            const portfolioData = [
                {
                    name: "êµ­ë‚´ì£¼ì‹",
                    value: parseFloat(data.domesticStock || 0),
                    color: "#FF6384",
                },
                {
                    name: "í•´ì™¸ì£¼ì‹",
                    value: parseFloat(data.overseasStock || 0),
                    color: "#36A2EB",
                },
                {
                    name: "êµ­ë‚´ì±„ê¶Œ",
                    value: parseFloat(data.domesticBond || 0),
                    color: "#FFCE56",
                },
                {
                    name: "í•´ì™¸ì±„ê¶Œ",
                    value: parseFloat(data.overseasBond || 0),
                    color: "#4BC0C0",
                },
                {
                    name: "í€ë“œíˆ¬ì",
                    value: parseFloat(data.fundInvestment || 0),
                    color: "#9966FF",
                },
                {
                    name: "ìœ ë™ì„±",
                    value: parseFloat(data.liquidity || 0),
                    color: "#FF9F40",
                },
            ];

            // 0ì´ ì•„ë‹Œ ë°ì´í„°ë§Œ í•„í„°ë§
            const nonZeroData = portfolioData.filter((item) => item.value > 0);

            if (nonZeroData.length === 0) {
                // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì°¨íŠ¸ ìˆ¨ê¸°ê¸°
                document.getElementById("portfolioChart").style.display =
                    "none";
                return;
            }

            // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´
            if (portfolioChart) {
                portfolioChart.destroy();
            }

            portfolioChart = new Chart(ctx, {
                type: "doughnut",
                data: {
                    labels: nonZeroData.map((item) => item.name),
                    datasets: [
                        {
                            data: nonZeroData.map((item) => item.value),
                            backgroundColor: nonZeroData.map(
                                (item) => item.color
                            ),
                            borderColor: nonZeroData.map((item) => item.color),
                            borderWidth: 2,
                            hoverOffset: 10,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: "ìì‚° êµ¬ì„± ë¹„ìœ¨",
                            font: { size: 16, weight: "bold" },
                            padding: { top: 10, bottom: 20 },
                        },
                        legend: {
                            position: "bottom",
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: { size: 12 },
                            },
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label;
                                    const value = context.parsed;
                                    return `${label}: ${value.toFixed(2)}%`;
                                },
                            },
                        },
                    },
                    cutout: "60%", // ë„ë„› ì¤‘ì•™ êµ¬ë© í¬ê¸°
                    animation: {
                        duration: 1500,
                        easing: "easeInOutQuart",
                    },
                },
            });

            // í…Œì´ë¸”ì˜ ë²”ë¡€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            updateTableLegend(nonZeroData);
        }
        // í…Œì´ë¸” ë²”ë¡€ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
        function updateTableLegend(portfolioData) {
            // ëª¨ë“  ìì‚° íƒ€ì…ì— ëŒ€í•´ ìƒ‰ìƒ ì„¤ì •
            const allAssets = [
                { name: "êµ­ë‚´ì£¼ì‹", color: "#FF6384" },
                { name: "í•´ì™¸ì£¼ì‹", color: "#36A2EB" },
                { name: "êµ­ë‚´ì±„ê¶Œ", color: "#FFCE56" },
                { name: "í•´ì™¸ì±„ê¶Œ", color: "#4BC0C0" },
                { name: "í€ë“œíˆ¬ì", color: "#9966FF" },
                { name: "ìœ ë™ì„±", color: "#FF9F40" },
            ];

            allAssets.forEach((asset) => {
                const legendElement = document.querySelector(
                    `[data-asset="${asset.name}"]`
                );
                if (legendElement) {
                    // í•´ë‹¹ ìì‚°ì´ ì°¨íŠ¸ì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
                    const isInChart = portfolioData.some(
                        (item) => item.name === asset.name
                    );

                    if (isInChart) {
                        // ì°¨íŠ¸ì— í‘œì‹œë˜ëŠ” ìì‚°ì€ í•´ë‹¹ ìƒ‰ìƒ ì‚¬ìš©
                        legendElement.style.backgroundColor = asset.color;
                        legendElement.style.opacity = "1";
                    } else {
                        // ì°¨íŠ¸ì— í‘œì‹œë˜ì§€ ì•ŠëŠ” ìì‚°ì€ íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œ
                        legendElement.style.backgroundColor = "#ddd";
                        legendElement.style.opacity = "0.5";
                    }
                }
            });
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getColor(value) {
            return value >= 0
                ? "rgba(255, 99, 132, 0.8)"
                : "rgba(54, 162, 235, 0.8)"; // ì–‘ìˆ˜=ë¹¨ê°„ìƒ‰, ìŒìˆ˜=íŒŒë€ìƒ‰
        }
        function getBorderColor(value) {
            return value >= 0
                ? "rgba(255, 99, 132, 1)"
                : "rgba(54, 162, 235, 1)"; // ì–‘ìˆ˜=ë¹¨ê°„ìƒ‰, ìŒìˆ˜=íŒŒë€ìƒ‰
        }
        function getPercentageClass(value) {
            const numValue = parseFloat(value || 0);
            if (numValue === 0) return "zero-value";
            if (numValue >= 50) return "percentage high";
            if (numValue >= 20) return "percentage medium";
            return "percentage low";
        }
        function formatPercentage(value) {
            return parseFloat(value || 0).toFixed(2);
        }
        // ìˆ˜ìµë¥  ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •
        function getReturnClass(value) {
            if (value > 0) return "return-positive"; // ë¹¨ê°„ìƒ‰
            if (value < 0) return "return-negative"; // íŒŒë€ìƒ‰
            return "return-zero"; // íšŒìƒ‰
        }
        // ìˆ˜ìµë¥  í¬ë§·íŒ… (ì–‘ìˆ˜ì— + ê¸°í˜¸ ì¶”ê°€)
        function formatReturnPercentage(value) {
            const formattedValue = value.toFixed(2);
            return value > 0 ? `+${formattedValue}` : formattedValue;
        }

        // ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function goBack() {
            // ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
            // window.location.href = "/fund/list";

            // í•œ í˜ì´ì§€ ë’¤ë¡œ
            // window.history.go(-1); // -1ì€ í•œ í˜ì´ì§€ ë’¤ë¡œ

            // ë¸Œë¼ìš°ì €ì˜ ì´ì „ í˜ì´ì§€ë¡œ ì´ë™
            window.history.back();
        }
        function joinFund() {
            if (!fundData) {
                alert("í€ë“œ ì •ë³´ë¥¼ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.");
                return;
            }

            if (!fundData.accessAllowed) {
                alert(
                    fundData.accessMessage || "ê°€ì… ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
                );
                return;
            }

            // ê°€ì…í•˜ê¸° í˜ì´ì§€ë¡œ ì´ë™ ë˜ëŠ” ê°€ì… ë¡œì§ ì‹¤í–‰
            /*
            if (confirm(`${fundData.fundName}ì— ê°€ì…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                window.location.href = `/funds/${fundData.fundId}/join`;
            }
            */
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener("DOMContentLoaded", function () {
            // const fundId = getFundIdFromUrl();
            const { fundId, investType, userId } = getDataFromMeta();

            if (!fundId) {
                showError("í€ë“œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            console.log(
                "í˜ì´ì§€ ë¡œë“œ - í€ë“œ ID:",
                fundId,
                "íˆ¬ì íƒ€ì…:",
                investType,
                "ì‚¬ìš©ì ID:",
                userId
            );
            loadFundDetail(fundId, investType, userId);
        });
    </script>

    <!-- Thymeleaf ë°ì´í„° ì „ë‹¬ì„ ìœ„í•œ ë©”íƒ€ íƒœê·¸ -->
    <meta name="invest-type" th:content="${investType}" />
    <meta name="user-id" th:content="${userId}" />
    <meta name="fund-id" th:content="${fundId}" />
</html>
